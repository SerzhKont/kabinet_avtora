<turbo-frame id="documents_table">
  <div class="table-container">
    <table class="table is-fullwidth is-hoverable is-narrow">
      <thead>
        <tr class="is-size-6">
          <th>
            <input
              type="checkbox"
              id="select-all-documents"
              data-checkbox-target="selectAll"
              data-action="change->checkbox#toggleAll"
            >
          </th>
          <th>
            <%= sort_link(@q, :title, "Назва", class: "has-text-black") %>
          </th>
          <th>
            <%= sort_link(@q, :status, "Статус", class: "has-text-black") %>
          </th>
          <th>
            <%= sort_link(@q, :author_name, "Автор", class: "has-text-black") %>
          </th>
          <th>
            <%= sort_link(@q, :extracted_code, "ІПН", class: "has-text-black") %>
          </th>
          <th>
            <%= sort_link(@q, :uploaded_by_name, "Завантажив", class: "has-text-black") %>
          </th>
          <th>
            <%= sort_link(@q, :created_at, "Додано", class: "has-text-black") %>
          </th>
          <th>
            <%= sort_link(@q, :signed_at, "Підписано", class: "has-text-black") %>
          </th>
          <th>Дії</th>
        </tr>
      </thead>
      <tbody>
        <% documents.each do |doc| %>
          <tr class="<%= 'has-background-warning-light' if doc.status == 'unlinked' %>">
            <td>
              <input
                type="checkbox"
                class="document-checkbox"
                name="document_ids[]"
                value="<%= doc.id %>"
                data-checkbox-target="checkbox"
                data-action="change->checkbox#toggleCheckbox"
              >
            </td>
            <td>
              <%= link_to doc.file.filename, rails_blob_url(doc.file, disposition: 'attachment') if doc.file.attached? %>
            </td>
            <td>
              <span class="tag <%= status_tag_class(doc.status) %> has-text-dark"><%= doc.status_label %></span>
            </td>
            <td><%= doc.author&.name %></td>
            <td><%= doc.extracted_code %></td>
            <td><%= doc.uploaded_by&.name %></td>
            <td><%= doc.created_at.strftime("%Y/%m/%d") %></td>
            <td><%= doc.signed_at&.strftime("%Y/%m/%d") %></td>
            <td>
              <div class="level mt-0 mb-0">
                <div class="level-left">
                  <div class="level-left">
                    <% if doc.file.attached? %>
                      <%= link_to rails_blob_path(doc.file, disposition: "attachment"), class: "has-text-dark", title: "Завантажити" do %>
                        <span class="icon is-small">
                          <i class="fas fa-download" aria-hidden="true"></i>
                        </span>
                      <% end %>
                    <% end %>
                  </div>

                  <div class="level-left">
                    <%= link_to edit_document_path(doc), class: "has-text-dark", title: "Редагувати", data: { turbo: false } do %>
                      <span class="icon is-small">
                        <i class="fas fa-edit" aria-hidden="true"></i>
                      </span>
                    <% end %>
                  </div>

                  <div class="level-left">
                    <%= link_to "#", class: "has-text-dark", title: "Видалити",
                      data: { 
                        controller: "modal",
                        action: "click->modal#open",
                        modal_id: "delete-modal-#{doc.id}" } do %>
                      <span class="icon is-small">
                        <i class="fas fa-trash-alt" aria-hidden="true"></i>
                      </span>
                    <% end %>
                    <% if doc.status == 'unlinked' %>
                      <%= link_to edit_document_path(doc), 
                        class: "button is-warning is-small", 
                        title: "Прив'язати автора",
                        data: { turbo: false } do %>
                        <span class="icon">
                          <i class="fas fa-link"></i>
                        </span>
                        <span>Прив'язати</span>
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>
              <div
                id="delete-modal-<%= doc.id %>"
                class="modal"
                data-controller="modal"
              >
                <div class="modal-background" data-action="click->modal#close"></div>
                <div class="modal-card">
                  <header class="modal-card-head">
                    <p class="modal-card-title">Підтвердіть видалення файла</p>
                    <button
                      class="delete"
                      aria-label="Submit document deletion and close"
                      data-action="click->modal#close"
                    ></button>
                  </header>

                  <section class="modal-card-body">
                    Ви впевнені, що хочете видалити документ
                    <strong><%= doc.title %></strong>
                    ?
                  </section>

                  <footer class="modal-card-foot">
                    <div class="buttons">
                      <%= button_to "Так, видалити", document_path(doc), method: :delete, class: "button is-danger" %>
                      <button class="button" data-action="click->modal#close">
                        Скасувати
                      </button>
                    </div>
                  </footer>
                </div>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <% if documents.empty? %>
    <p>Документи не знайдено.</p>
  <% else %>
    <% if pagy && pagy.pages > 1 %>
      <%== pagy_nav(pagy) %>
    <% end %>
  <% end %>
</turbo-frame>
