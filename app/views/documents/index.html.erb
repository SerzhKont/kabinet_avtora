<div class="columns is-gap-1">
  <div class="column is-2 has-border-right">
    <%= render "layouts/sidebar" %>
  </div>
  <div class="column">
    <div class="field is-grouped">
      <div class="control">
        <input class="input" type="text" placeholder="Поиск...">
      </div>
      <div class="control">
        <button class="button is-primary">Найти</button>
      </div>
      <div class="control">
        <%= link_to "Завантажити документи", new_document_path, class: "button is-primary" %>
      </div>
    </div>
    <div class="mb-4">
      <%= link_to "Всі", documents_path, class: "button is-small #{'is-link' if params[:status].blank?}" %>
      <%= link_to "З клієнтом", documents_path(status: 'linked'), class: "button is-small #{'is-link' if params[:status] == 'linked'}" %>
      <%= link_to "Без клієнта", documents_path(status: 'unlinked'), class: "button is-small #{'is-link' if params[:status] == 'unlinked'}" %>
    </div>
    <table class="table is-fullwidth is-hoverable">
      <thead>
        <tr>
          <th>Назва</th>
          <th>Опис</th>
          <th>Статус</th>
          <th>Клієнт</th>
          <th>Завантажив</th>
          <th>Додано</th>
          <th>Підписано</th>
          <th>Дії</th>
        </tr>
      </thead>
      <tbody>
        <% @documents.each do |doc| %>
          <tr class="<%= 'has-background-warning-light' if doc.status == 'unlinked' %>">
            <td><%= doc.title.presence || (doc.file.attached? ? doc.file.filename : '-') %></td>
            <td><%= doc.description.presence || '-' %></td>
            <td><%= doc.status_label %></td>
            <td><%= doc.client&.name || '❌ Не знайдено' %></td>
            <td><%= doc.uploaded_by&.name || '-' %></td>
            <td><%= doc.created_at.strftime("%Y-%m-%d %H:%M") %></td>
            <td><%= doc.signed_at&.strftime("%Y-%m-%d %H:%M") || '-' %></td>
            <td>
              <% if doc.file.attached? %>
                <%= link_to "Завантажити", rails_blob_path(doc.file, disposition: "attachment"), class: "button is-small is-ghost" %>
              <% end %>
              <%= link_to "Редагувати", edit_document_path(doc), class: "button is-small is-ghost" %>
              <a class="button is-small is-ghost" onclick="document.getElementById('delete-modal-<%= doc.id %>').classList.add('is-active')">
                Видалити
              </a>
              <div id="delete-modal-<%= doc.id %>" class="modal">
                <div class="modal-background"></div>
                <div class="modal-card">
                  <header class="modal-card-head">
                    <p class="modal-card-title">Підтвердіть видалення файла</p>
                    <button class="delete" aria-label="close" onclick="this.closest('.modal').classList.remove('is-active')"></button>
                  </header>
                  <section class="modal-card-body">
                    Ви впевнені, що хочете видалити документ <strong><%= doc.title %></strong>?
                  </section>
                  <footer class="modal-card-foot">
                    <div class="buttons">
                      <%= button_to "Так, видалити",
                                    document_path(doc),
                                    method: :delete,
                                    class: "button is-danger" %>
                      <button class="button" onclick="this.closest('.modal').classList.remove('is-active')">Скасувати</button>
                    </div>
                  </footer>
                </div>
              </div>
              <% if doc.status == "linked" %>
                <%= link_to "Відправити на підпис", send_to_client_document_path(doc), method: :patch, data: { confirm: "Відправити на підпис?" }, class: "button is-small is-ghost" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
