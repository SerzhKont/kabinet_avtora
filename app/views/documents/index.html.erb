<div class="columns is-gap-1">
  <div class="column is-narrow has-border-right">
    <%= render "layouts/sidebar" %>
  </div>
  <div class="column">
    <div class="field is-grouped">
      <div class="control">
        <input class="input" type="text" placeholder="Поиск...">
      </div>
      <div class="control">
        <button class="button is-primary">Найти</button>
      </div>
      <div class="control">
        <%= link_to "Завантажити документи", new_document_path, class: "button is-primary" %>
      </div>
    </div>
    <div class="mb-4">
      <%= link_to "Всі",
      documents_path,
      class: "button is-small #{"is-link" if params[:status].blank?}" %>
      <%= link_to "З клієнтом",
      documents_path(status: "linked"),
      class: "button is-small #{"is-link" if params[:status] == "linked"}" %>
      <%= link_to "Без клієнта",
      documents_path(status: "unlinked"),
      class: "button is-small #{"is-link" if params[:status] == "unlinked"}" %>
    </div>
    <table class="table is-fullwidth is-hoverable is-narrow">
      <thead>
        <tr class="is-size-6">
          <th>Назва</th>
          <th>Статус</th>
          <th>Клієнт</th>
          <th>ІПН</th>
          <th>Завантажив</th>
          <th>Додано</th>
          <th>Підписано</th>
          <th>Коментар</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @documents.each do |doc| %>
          <tr class="<%= 'has-background-warning-light' if doc.status == 'unlinked' %>">
            <td><%= doc.title.presence || (doc.file.attached? ? doc.file.filename : "-") %></td>
            <td>
              <span class="tag <%= status_tag_class(doc.status) %> has-text-dark">
                <%= doc.status_label %>
              </span>
            </td>
            <td><%= doc.author&.name || "-" %></td>
            <td><%= doc.extracted_code || "-" %></td>
            <td><%= doc.uploaded_by&.name || "-" %></td>
            <td><%= doc.created_at.strftime("%Y/%m/%d") %></td>
            <td><%= doc.signed_at&.strftime("%Y/%m/%d") || "-" %></td>
            <td>
              <div class="dropdown dropdown-table is-right">
                <div class="dropdown-trigger">
                  <button
                    class="button is-small"
                    aria-haspopup="true"
                    aria-controls="dropdown-table-menu"
                  >
                    <span class="icon is-small">
                      <i class="fas fa-ellipsis-v" aria-hidden="true"></i>
                    </span>
                  </button>
                </div>
                <div class="dropdown-menu" id="dropdown-table-menu" role="menu">
                  <div class="dropdown-content">

                    <% if doc.file.attached? %>
                      <%= link_to rails_blob_path(doc.file, disposition: "attachment"), class: "dropdown-item" do %>
                        <span class="icon is-small">
                          <i class="fas fa-download" aria-hidden="true"></i>
                        </span>
                        Завантажити
                      <% end %>
                    <% end %>
                    <%= link_to edit_document_path(doc), class: "dropdown-item" do %>
                      <span class="icon is-small"><i class="fas fa-edit" aria-hidden="true"></i></span>
                      Редагувати
                    <% end %>

                    <a
                      href
                      class="dropdown-item"
                      onclick="document.getElementById('delete-modal-<%= doc.id %>').classList.add('is-active')"
                    >
                      <span class="icon is-small"><i class="fas fa-trash-alt" aria-hidden="true"></i></span>
                      Видалити
                    </a>

                  </div>
                </div>
              </div>

              <div id="delete-modal-<%= doc.id %>" class="modal">
                <div class="modal-background"></div>
                <div class="modal-card">
                  <header class="modal-card-head">
                    <p class="modal-card-title">Підтвердіть видалення файла</p>
                    <button
                      class="delete"
                      aria-label="Submit document deletion and close"
                      onclick="this.closest('.modal').classList.remove('is-active')"
                    ></button>
                  </header>
                  <section class="modal-card-body">
                    Ви впевнені, що хочете видалити документ
                    <strong><%= doc.title %></strong>?
                  </section>
                  <footer class="modal-card-foot">
                    <div class="buttons">
                      <%= button_to "Так, видалити",
                      document_path(doc),
                      method: :delete,
                      class: "button is-danger" %>
                      <button
                        class="button"
                        onclick="this.closest('.modal').classList.remove('is-active')"
                      >Скасувати</button>
                    </div>
                  </footer>
                </div>
              </div>

            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
